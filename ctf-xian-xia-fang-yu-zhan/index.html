<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
    

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?48851b97e1ed0c9c199b9a7c27cc1cf7";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta name="keywords" content="CTF线下防御战—让你的靶机变成&#34;铜墙铁壁&#34;, ssooking&#39;s blog">
    <meta name="description" content="一. 前言　　随着CTF的普及，比赛的形式也有了越来越多的花样，对于线下赛来说，开始出现了安全加固或者防御战之类的环节，亦或者因为拿下靶机后不希望其他攻击者进入而进行“争夺”，无论什么形式，这些都需要我们对于服务器的防护工作有所了解。对于线">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>CTF线下防御战—让你的靶机变成&#34;铜墙铁壁&#34; | ssooking&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css"></head>

</head>

<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="container">
            <div class="nav-wrapper">
                <div class="brand-logo">
                    <a href="/" class="waves-effect waves-light">
                        
                        <img src="/medias/logo.png" class="logo-img hide-on-small-only">
                        
                        <span class="logo-span">ssooking's blog</span>
                    </a>
                </div>
                <a href="#" data-activates="mobile-nav" class="button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>Index</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>Tags</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>Categories</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>Archives</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>About</span>
        </a>
    </li>
    
    <li>
        <a id="toggleSearch" class="waves-effect waves-light">
            <i id="searchIcon" class="mdi-action-search"></i>
        </a>
    </li>

</ul>

<div class="side-nav" id="mobile-nav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">ssooking's blog</div>
        <div class="logo-desc">
            
            征途漫漫，步履铿锵，无畏、无惧、无阻！
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                Index
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                Tags
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                Categories
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                Archives
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                About
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/ssooking" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>

    <div class="social-link"><a href="https://github.com/ssooking" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
    <i class="fa fa-github"></i>
</a>
<a href="mailto:ssooking@yeah.net" class="tooltipped" target="_blank" data-tooltip="mail：ssooking@yeah.net" data-position="top" data-delay="50">
    <i class="fa fa-envelope-open"></i>
</a>

<a href="#!" class="tooltipped" data-tooltip="wechat: licg18238296977" data-position="top" data-delay="50">
    <i class="fa fa-wechat"></i>
</a>

<a href="#!" class="tooltipped" data-tooltip="QQ: 1652010949" data-position="top" data-delay="50">
    <i class="fa fa-qq"></i>
</a>

<a href="https://join.skype.com/invite/PWgoTe4YvrbH" class="tooltipped" target="_blank" data-tooltip="skype：ssooking" data-position="top" data-delay="50">
    <i class="fa fa-skype"></i>
</a>

</div>
</div>

            </div>
        </div>

        
        <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/ssooking" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewbox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/>
    </svg>
</a>
        
    </nav>
</header>



<div class="bg-cover post-cover" style="background-image: url('/medias/featureimages/0.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        CTF线下防御战—让你的靶机变成&#34;铜墙铁壁&#34;
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1,
    #articleContent h2,
    #articleContent h3,
    #articleContent h4,
    #articleContent h5,
    #articleContent h6 {
        padding-top: 76px;
        margin-top: -76px;
    }

    #articleContent h1 {
        line-height: 3.5rem;
    }

    #articleContent h2 {
        line-height: 3.2rem;
    }

    #articleContent h3 {
        line-height: 2.8rem;
    }

    #articleContent h4 {
        line-height: 2.5rem;
    }

    #articleContent h5 {
        line-height: 2.2rem;
    }

    #articleContent h6 {
        line-height: 1.9rem;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }
</style>
<div class="row">
    <div class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            
            <div class="article-tag">
                
                <a href="/tags/linux/" target="_blank">
                    <span class="chip bg-color">linux</span>
                </a>
                
                <a href="/tags/CTF/" target="_blank">
                    <span class="chip bg-color">CTF</span>
                </a>
                
            </div>
            
            <div class="post-info">
                
                <span class="post-cate">
                    <i class="fa fa-bookmark fa-fw icon-category"></i>
                    
                    <a href="/categories/CTF/" class="post-category" target="_blank">
                        CTF
                    </a>
                    
                </span>
                

                <span class="post-date">
                    <i class="fa fa-clock-o fa-fw"></i>2017-10-10
                </span>
            </div>
        </div>
        <hr>
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="一-前言"><a href="#一-前言" class="headerlink" title="一. 前言"></a>一. 前言</h1><p>　　随着CTF的普及，比赛的形式也有了越来越多的花样，对于线下赛来说，开始出现了安全加固或者防御战之类的环节，亦或者因为拿下靶机后不希望其他攻击者进入而进行“争夺”，无论什么形式，这些都需要我们对于服务器的防护工作有所了解。对于线下赛，笔者虽说没有什么很高超的攻防技巧，但也是有着一些自己的心得。本文总结了一些CTF线下赛中常用的服务器加固姿势，希望能对各位CTF朋友们有所帮助。环境针对目前常见线下赛常见的linux Web服务器，但是因为CTF毕竟与真实网络环境有很大区别，本文的涉及的大部分姿势不具有普遍适用性。本文涉及到的相关代码github下载地址：<a href="https://github.com/ssooking/CTFDefense" target="_blank" rel="noopener">CTFDefense</a>。</p>
<p><img src="https://raw.githubusercontent.com/ssooking/imgbed/master/hello.jpg" alt="img"></p>
<h1 id="二-常用姿势"><a href="#二-常用姿势" class="headerlink" title="二. 常用姿势"></a>二. 常用姿势</h1><h2 id="1-提权"><a href="#1-提权" class="headerlink" title="1. 提权"></a>1. 提权</h2><p>　　在开始正文之前，需要先提一下提权，这个要根据自己的比赛过程中的需要而定。有些比赛就有专门的防御加固环节，但安全加固的很多操作都会涉及到root权限，如果直接给root权限最好，但一般一开始会给一个普通权限账号，或者干脆什么都不给，需要我们自己通过漏洞拿下服务器，这样往往就需要提权了。关于提权，通常我们要根据kernel版本号找到对应的poc，平时我们可以收集测试一些比较新的提权poc，以备不时之需。这里有一个网站：<a href="http://exploit.linuxnote.org/" target="_blank" rel="noopener">http://exploit.linuxnote.org/</a>，里面有许多linux本地提权的poc。github上有一个挺全的提权exp项目：<a href="https://github.com/SecWiki/linux-kernel-exploits" target="_blank" rel="noopener">https://github.com/SecWiki/linux-kernel-exploits</a>。网上也有人分享的一些打包搜集的poc,比如<a href="https://bbs.77169.com/forum.php?mod=viewthread&amp;tid=363466" target="_blank" rel="noopener">这个</a>，有兴趣的朋友可以多下载看看。</p>
<p>下面分享几个最近两年并且影响范围比较大的：</p>
<p><a href="https://github.com/torvalds/linux/commit/5edabca9d4cff7f1f2b68f0bac55ef99d9798ba4" target="_blank" rel="noopener">CVE-2017-6074 (DCCP双重释放漏洞 &gt; 2.6.18 ）</a><br>描述：DCCP双重释放漏洞可允许本地低权限用户修改Linux内核内存，导致拒绝服务（系统崩溃）或者提升权限，获得系统的管理访问权限<br>用法：./pwn<br><a href="https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs" target="_blank" rel="noopener">CVE-2016-5195（脏牛，kernel 2.6.22 &lt; 3.9 (x86/x64)）</a><br>描述：低权限用户可修改root用户创建的文件内容，如修改 /etc/passwd，把当前用户的 uid 改成 0 即可提升为root权限<br>用法： ./dirtyc0w file content<br><a href="https://github.com/torvalds/linux/commit/f6fb8f100b807378fda19e83e5ac6828b638603a" target="_blank" rel="noopener">CVE-2016-8655（Ubuntu 12.04、14.04，Debian 7、8）</a><br>描述：条件竞争漏洞，可以让低权限的进程获得内核代码执行权限<br>用法：./chocobo_root<br>POC： <a href="https://www.seebug.org/vuldb/ssvid-92567" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-92567</a><br><a href="https://github.com/c0d3z3r0/sudo-CVE-2017-1000367" target="_blank" rel="noopener">CVE-2017-1000367（sudo本地提权漏洞 ）</a><br>CVE-2017-1000364<br>描述：Linux Kernel Stack Clash安全漏洞。该漏洞是由于操作系统内存管理中的一个堆栈冲突漏洞，它影响Linux，FreeBSD和OpenBSD，NetBSD，Solaris，i386和AMD64，攻击者可以利用它破坏内存并执行任意代码 。</p>
<p><a href="https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html" target="_blank" rel="noopener">CVE-2016-1247（Nginx权限提升漏洞）</a></p>
<p>描述：Nginx服务在创建log目录时使用了不安全的权限设置，可造成本地权限提升，恶意攻击者能够借此实现从 nginx/web 的用户权限 www-data 到 root 用户权限的提升。</p>
<p>POC：<a href="https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html" target="_blank" rel="noopener">https://legalhackers.com/advisories/Nginx-Exploit-Deb-Root-PrivEsc-CVE-2016-1247.html</a></p>
<p>　</p>
<p>　提权相关代码在GetRoot目录，POC中是上面提到的几个本地提权源代码，release中分别是编译好的32位和64位程序。 </p>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201710/1012328-20171001103247387-2092258840.png" alt="img"></p>
<p>实用脚本</p>
<p>　　 <a href="https://github.com/PenturaLabs/Linux_Exploit_Suggester.git" target="_blank" rel="noopener">Linux_Exploit_Suggester.pl</a> ，它可以根据系统内核版本号返回一个包含了可能exploits的列表。还有一个检查linux安全状况的脚本：<a href="http://www.freebuf.com/sectool/108564.html" target="_blank" rel="noopener">原文链接</a></p>
<p>　　还有几个详见：<a href="http://www.freebuf.com/sectool/121847.html" target="_blank" rel="noopener">Linux提权？这四个脚本可以帮助你</a></p>
<h2 id="2-常用操作命令"><a href="#2-常用操作命令" class="headerlink" title="2. 常用操作命令"></a>2. 常用操作命令</h2><p>　　linux操作有很多命令，但是线下赛的防护工作中常用的也就那么一些，我们平时可以留意并总结起来，便于我们比赛使用。</p>
<pre class=" language-bash"><code class="language-bash">ssh操作
<span class="token function">ssh</span> <span class="token operator">&lt;</span>-p 端口<span class="token operator">></span> 用户名@IP　　//登录
<span class="token function">scp</span> 文件路径  用户名@IP:存放路径　　//向ssh服务器上传输文件

备份web目录
　　<span class="token function">tar</span> -zcvf web.tar.gz /var/www/html/
用户管理
　　w 　　//查看当前用户
　　<span class="token function">pkill</span> -kill -t <span class="token operator">&lt;</span>用户tty<span class="token operator">></span>　　 //踢掉当前登录用户

进程管理
　　<span class="token function">ps</span> aux <span class="token operator">|</span> <span class="token function">grep</span> pid或者进程名　　//查看进程信息

　　查看已建立的网络连接及进程
　　<span class="token function">netstat</span> -antulp <span class="token operator">|</span> <span class="token function">grep</span> EST

　　查看指定端口被哪个进程占用
　　<span class="token function">lsof</span> -i:端口号 或者 <span class="token function">netstat</span> -tunlp<span class="token operator">|</span><span class="token function">grep</span> 端口号

　　结束进程命令
　　<span class="token function">kill</span> PID
　　<span class="token function">killall</span> <span class="token operator">&lt;</span>进程名<span class="token operator">></span>
　　<span class="token function">kill</span> -9 <span class="token operator">&lt;</span>PID<span class="token operator">></span>

iptables命令

　　封杀某个IP或者ip段，如：123.4.5.6
　　iptables -I INPUT -s 123.4.5.6 -j DROP
　　iptables -I INPUT -s 123.4.5.1/24 -j DROP

　　禁止从某个主机ssh远程访问登陆到本机，如123.4.5.6
　　iptable -t filter -A INPUT -s 123.4.5.6 -p tcp --dport 22 -j DROP

Mysql数据库操作

　　备份mysql数据库
　　mysqldump -u 用户名 -p 密码 数据库名 <span class="token operator">></span> back.sql　　//备份指定数据库
　　mysqldump --all-databases <span class="token operator">></span> bak.sql　　　　//备份所有数据库

　　还原mysql数据库
　　mysql -u 用户名 -p 密码 数据库名 <span class="token operator">&lt;</span> bak.sql

安全检查

　　<span class="token function">find</span> / *.php -perm 4777 　　 //查找777的权限的php文件 
　　<span class="token function">awk</span> -F: <span class="token string">'{if(<span class="token variable">$3</span>==0)print <span class="token variable">$1</span>}'</span> /etc/passwd　　//查看root权限的账号
　　<span class="token function">crontab</span> -l　　//查看计划任务

　　检测所有的tcp连接数量及状态
　　<span class="token function">netstat</span> -ant<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$5</span> "\t" <span class="token variable">$6</span>}'</span> <span class="token operator">|</span><span class="token function">grep</span> <span class="token string">"[1-9][0-9]*\."</span><span class="token operator">|</span><span class="token function">sed</span> -e <span class="token string">'s/::ffff://'</span> -e <span class="token string">'s/:[0-9]*//'</span><span class="token operator">|</span><span class="token function">sort</span><span class="token operator">|</span><span class="token function">uniq</span> -c<span class="token operator">|</span><span class="token function">sort</span> -rn

　　查看页面访问排名前十的IP
　　<span class="token function">cat</span> /var/log/apache2/access.log <span class="token operator">|</span> <span class="token function">cut</span> -f1 -d <span class="token string">" "</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> -c <span class="token operator">|</span> <span class="token function">sort</span> -k 1 -r <span class="token operator">|</span> <span class="token function">head</span> -10

　　查看页面访问排名前十的URL
　　<span class="token function">cat</span> /var/log/apache2/access.log <span class="token operator">|</span> <span class="token function">cut</span> -f4 -d <span class="token string">" "</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> -c <span class="token operator">|</span> <span class="token function">sort</span> -k 1 -r <span class="token operator">|</span> <span class="token function">head</span> -10　　
</code></pre>
<p>　　再推荐两篇篇安全应急排查手册：<a href="https://yq.aliyun.com/articles/177337" target="_blank" rel="noopener">应急排查手册</a><a href="https://yq.aliyun.com/articles/177337%20" target="_blank" rel="noopener"> </a>，<a href="https://xianzhi.aliyun.com/forum/mobile/read/2150.html" target="_blank" rel="noopener">Linux应急响应姿势浅谈</a></p>
<h2 id="3-文件监控防webshell"><a href="#3-文件监控防webshell" class="headerlink" title="3. 文件监控防webshell"></a>3. 文件监控防webshell</h2><p>　　防御webshell，我们可以监控我们的web目录，对文件的增加或修改等操作进行限制等，粗暴一点的话，就禁止任何文件产生变化，杜绝被传webshell的可能性。</p>
<p>（1）使用系统 chattr +i 命令<br>　　linux下的文件有着隐藏属性，可以用lsattr命令查看。其中有一个i属性，表示不得更动任意文件或目录。如果你已经有root或者sudo权限了，那么你可以使用”chattr +i 命令”修改文件隐藏属性，这样所有用户都不能对该文件或者目录进行修改删除等操作（包括root），如果想进行修改，必须用命令”chattr -i”取消隐藏属性。<br><a href="http://www.runoob.com/linux/linux-comm-chattr.html" target="_blank" rel="noopener">Linux文件保护禁止修改、删除、移动文件等,使用chattr +i保护</a></p>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170902184611437-2010938649.png" alt="img"></p>
<p>例子：<br>用chattr命令防止系统中某个关键文件被修改：</p>
<pre><code>chattr +i /etc/profile 
</code></pre><p>将/var/www/html目录下的文件设置为不允许任何人修改：</p>
<pre><code>chattr -R +i /var/www/html 
</code></pre><p><img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170902184623437-649479414.png" alt="img"></p>
<p>（2）自己动手丰衣足食<br>　　python的第三方库pyinotify可以让我们很方便地实现这些功能。但是由于是第三方库，线下赛中通常没法联网安装库，所以我们可以手工把库文件传到靶机里python库中: /usr/lib/pythonXXX/site-packages，但是更方便的做法是借用pyinstaller等工具将其打包成linux可执行文件。</p>
<p>　　安装了pyinotify库之后，我们仅仅运行在机器上： “python -m pyinotify 监控目录路径” 这条简单的命令，就可以看到对这个目录以及该目录下所有进行任何操作的的监控日志。<br><img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170902184646562-176521649.png" alt="img"></p>
<p> 　　但由于监控事件太过杂，很多并不是我们关注的，并且我们不仅仅要监控，还需要对某些操作进行自动处理，因此我们可以自己编程，针对性地实现我们需要的功能，下面是一段代码示例。</p>
<p>　　　　关于pyinotify 库的用法不再赘述，可以看到我在上述代码中创建了一个事件监控处理的类EventHandler，在这个示例中，我们仅仅关注创建、删除、修改属性、移动操作事件，并且我定义了一个DeleteFileOrDir方法用于自动删除增加的目录或者文件。运行测试截图：</p>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170902184705296-121778766.png" alt="img"></p>
<p>　　我们可以编写功能更加细化的程序，实现如监控文件变更，禁止创建、修改、删除任何文件或目录，自动删除新增文件，把被修改的文件改回去, 删除畸形隐藏文件等功能。我们使用pyinstaller把我代码打包为linux的elf可执行文件。-F参数表示打包为独立可运行文件，命令执行完之后自动生成：build、dist文件夹和SimpleMonitor.spec文件，你可以在dist目录里找到生成的elf程序。</p>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201710/1012328-20171001103154294-666393591.png" alt="img"></p>
<p> 打包的文件在CTFDefense项目的Monitor目录下</p>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201710/1012328-20171001103128012-68438767.png" alt="img"> </p>
<h2 id="4-网络监控断异常连接"><a href="#4-网络监控断异常连接" class="headerlink" title="4. 网络监控断异常连接"></a>4. 网络监控断异常连接</h2><p>　　linux安全防护一定少不了 iptables了，使用iptables需要有管理员权限。对于比赛环境，我们完全可以配置一个近乎苛刻的配置防火墙策略。</p>
<p>　　具体我们可以做哪些工作呢，举一些例子：</p>
<p><strong>（1）关闭所有网络端口，只开放一些比赛的必要端口，也可以防止后门的连接</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#开放ssh</span>
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT

<span class="token comment" spellcheck="true">#打开80端口</span>
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT

<span class="token comment" spellcheck="true">#开启多端口简单用法</span>
iptables -A INPUT -p tcp -m multiport --dport 22,80,8080,8081 -j ACCEPT
</code></pre>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#允许外部访问本地多个端口 如8080，8081，8082,且只允许是新连接、已经连接的和已经连接的延伸出新连接的会话</span>
iptables -A INPUT -p tcp -m multiport --dport 8080,8081,8082,12345 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
iptables -A OUTPUT -p tcp -m multiport --sport 8080,8081,8082,12345 -m state --state ESTABLISHED -j ACCEPT
</code></pre>
<p><strong>（2）限制ssh登陆，进行访问控制</strong></p>
<pre class=" language-bash"><code class="language-bash">iptable -t filter -A INPUT -s 123.4.5.6 -p tcp --dport 22 -j DROP 　　//禁止从123.4.5.6远程登陆到本机
iptables -A INPUT -s 123.4.5.6/24 -p tcp --dport 22 -j ACCEPT　　//允许123.4.5.6网段远程登陆访问ssh
</code></pre>
<p><strong>（3）限制IP连接数和连接速率</strong></p>
<p>　　我们可以限制IP的网络连接数和速度等，限制过快的连接频率，这样可以在一定程度上限制对方的扫描器。狠一点的话，甚至可以让对方只能以手工点网页的速度与访问+_+</p>
<p>单个IP的最大连接数为 30</p>
<pre class=" language-bash"><code class="language-bash">iptables -I INPUT -p tcp --dport 80 -m connlimit --connlimit-above 30 -j REJECT
</code></pre>
<p>单个IP在60秒内只允许最多新建15个连接</p>
<pre class=" language-bash"><code class="language-bash">iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --update --seconds 60 --hitcount 15 -j REJECT
iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --set -j ACCEPT
</code></pre>
<p>允许外部访问本机80端口，且本机初始只允许有10个连接，每秒新增加2个连接，如果访问超过此限制则拒接 （此方式可以限制一些攻击）</p>
<pre class=" language-bash"><code class="language-bash">iptables -A INPUT -p tcp --dport 80 -m limit --limit 2/s --limit-burst 10 -j ACCEPT
iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT
</code></pre>
<p>　　再猥琐一点，可以定时断开已经建立的连接，让对方只能断断续续的访问~~</p>
<p><strong>（4）数据包简单识别，防止端口复用类的后门或者shell</strong></p>
<p>　　假设病毒木马程序通过22，80端口像服务器外传送数据，这种方式发向外发的数据不是我们通过访问网页请求而回应的数据包。我们可以禁止这些没有通过请求回应的数据包。</p>
<pre class=" language-bash"><code class="language-bash">iptables -A OUTPUT -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEP
</code></pre>
<p><strong>（5）限制访问</strong></p>
<p>如果对方来势太凶，我们可以限制或者封杀他们的ip段。</p>
<pre class=" language-bash"><code class="language-bash">iptable -t filter -A FORWARD -s 123.4.5.6 -d 123.4.5.7 -j DROP　　//禁止从客户机123.4.5.6访问123.4.5.7上的任何服务
</code></pre>
<p>封杀123.4.5.6这个IP或者某个ip段</p>
<pre class=" language-bash"><code class="language-bash">iptables -I INPUT -s 123.4.5.6 -j DROP
iptables -I INPUT -s 123.4.5.1/24 -j DROP
</code></pre>
<p><strong>（6）过滤异常报文</strong></p>
<p>　　iptables有一个TCP匹配扩展协议–tcp-flags，功能是过滤TCP中的一些包，比如SYN包，ACK包，FIN包，RST包等等。举个例子，我们知道SYN是建立连接，RST是重置连接，如果这两个同时出现，就知道这样的包是有问题的，应该丢弃。下面的例子是利用–tcp-flags参数，对一些包进行标识过滤，扔掉异常的数据包。</p>
<pre class=" language-bash"><code class="language-bash">iptables -A INPUT -p tcp --tcp-flags SYN,FIN,ACK,RST SYN 　　　　　　　　<span class="token comment" spellcheck="true">#表示 SYN,FIN,ACK,RST的标识都检查，但只匹配SYN标识</span>
iptables -A INPUT -p tcp --syn 　　　　　　　　　　　　　　　　　　　　　　　 <span class="token comment" spellcheck="true">#匹配SYN标识位</span>
iptables -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP 　　　　　 <span class="token comment" spellcheck="true">#检查所有的标识位，匹配到FIN URG PSH的丢弃</span>
iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP 　　　　　　　　　 <span class="token comment" spellcheck="true">#丢弃没标志位的包</span>
iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -j DROP　<span class="token comment" spellcheck="true">#匹配到SYN ACK FIN URG的丢弃</span>
iptables -A INPUT -p tcp --tcp-flags ALL SYN,FIN,RST -j DROP　　　　　　<span class="token comment" spellcheck="true">#匹配到SYN ACK FIN RST的丢弃</span>
iptables -A INPUT -p tcp --tcp-flags ALL SYN,FIN,PSH -j DROP　　　　　　<span class="token comment" spellcheck="true">#匹配到SYN FIN PSH的丢弃</span>
iptables -A INPUT -p tcp --tcp-flags ALL SYN,FIN,RST,PSH -j DROP　 　　<span class="token comment" spellcheck="true">#匹配到SYN FIN RST PSH的丢弃</span>
iptables -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP　　　　　　<span class="token comment" spellcheck="true">#匹配到 SYN,RST的丢弃</span>
iptables -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP 　　　　　 <span class="token comment" spellcheck="true">#匹配到 SYN,FIN的丢弃</span>
</code></pre>
<p><strong> （7）防DDOS攻击</strong></p>
<pre class=" language-bash"><code class="language-bash">iptables -A INPUT -p tcp --dport 80 -m limit --limit 20/minute --limit-burst 100 -j ACCEPT
</code></pre>
<p>　　-m limit: 启用limit扩展<br>　　–limit 20/minute: 允许最多每分钟10个连接<br>　　–limit-burst 100: 当达到100个连接后，才启用上述20/minute限制</p>
<p>丢弃陌生的TCP响应包,防止反弹式攻击</p>
<pre class=" language-bash"><code class="language-bash">iptables -A INPUT -m state --state NEW -p tcp <span class="token operator">!</span> --syn -j DROP
iptables -A FORWARD -m state --state NEW -p tcp --syn -j DROP
</code></pre>
<p>　　更多的姿势，需要打开我们的脑洞了，下面是一个通用的firewall脚本，我们可以传到服务器上一键执行，相关参数可以查阅资料详细了解：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment" spellcheck="true">#Allow youself Ping other hosts , prohibit others Ping you</span>
iptables -A INPUT -p icmp --icmp-type 8 -s 0/0 -j DROP
iptables -A OUTPUT -p icmp --icmp-type 8 -s 0/0 -j ACCEPT

<span class="token comment" spellcheck="true">#Close all INPUT FORWARD OUTPUT, just open some ports</span>
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT DROP

<span class="token comment" spellcheck="true">#Open ssh</span>
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
iptables -A OUTPUT -p tcp --sport 22 -j ACCEPT

<span class="token comment" spellcheck="true">#Open port 80</span>
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A OUTPUT -p tcp --sport 80 -j ACCEPT


<span class="token comment" spellcheck="true">#Open multiport</span>
<span class="token comment" spellcheck="true">#iptables -A INPUT -p tcp -m multiport --dport 22,80,8080,8081 -j ACCEPT</span>

<span class="token comment" spellcheck="true">#Control IP connection</span>
<span class="token comment" spellcheck="true">#The maximum number of connections for a single IP is 30</span>
iptables -I INPUT -p tcp --dport 80 -m connlimit --connlimit-above 30 -j REJECT

<span class="token comment" spellcheck="true">#A single IP allows up to 15 new connections in 60 seconds</span>
iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --update --seconds 60 --hitcount 15 -j REJECT
iptables -A INPUT -p tcp --dport 80 -m recent --name BAD_HTTP_ACCESS --set -j ACCEPT

<span class="token comment" spellcheck="true">#Prevent port reuse</span>
iptables -A OUTPUT -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT
iptables -A OUTPUT -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT

<span class="token comment" spellcheck="true">#Filter abnormal packets</span>
iptables -A INPUT -i eth1 -p tcp --tcp-flags SYN,RST,ACK,FIN SYN -j DROP
iptables -A INPUT -p tcp --tcp-flags ALL FIN,URG,PSH -j DROP
iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP 
iptables -A INPUT -p tcp --tcp-flags ALL SYN,RST,ACK,FIN,URG -j DROP
iptables -A INPUT -p tcp --tcp-flags ALL SYN,FIN,RST -j DROP
iptables -A INPUT -p tcp --tcp-flags ALL SYN,FIN,PSH -j DROP
iptables -A INPUT -p tcp --tcp-flags ALL SYN,FIN,RST,PSH -j DROP
iptables -A INPUT -p tcp --tcp-flags SYN,RST SYN,RST -j DROP 
iptables -A INPUT -p tcp --tcp-flags SYN,FIN SYN,FIN -j DROP

<span class="token comment" spellcheck="true">#Prevent DoS attacks</span>
iptables -A INPUT -p tcp --dport 80 -m limit --limit 20/minute --limit-burst 100 -j ACCEPT

<span class="token comment" spellcheck="true">#Discard unfamiliar TCP response packs to prevent rebound attacks</span>
iptables -A INPUT -m state --state NEW -p tcp <span class="token operator">!</span> --syn -j DROP
iptables -A FORWARD -m state --state NEW -p tcp --syn -j DROP
</code></pre>
<p>注意，对于不同的iptables版本，一些参数的用法可以会有略微的差异，使用时我们可能要根据需要进行修改。</p>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201710/1012328-20171001103058590-1008831481.png" alt="img"></p>
<h2 id="5-综合分析控阻溢出类攻击"><a href="#5-综合分析控阻溢出类攻击" class="headerlink" title="5. 综合分析控阻溢出类攻击"></a>5. 综合分析控阻溢出类攻击</h2><p>　　关于溢出类攻击，我还没有总结出一些很实用的姿势，这里提供一些思路。</p>
<p>　　一般来说，溢出攻击成功后，会建立shell通道和网络连接，我们可以配合前面提到的命令，从这两方面入手进行检测和阻隔：</p>
<ul>
<li><p>　　检测高权限的进程</p>
</li>
<li><p>　　检测sh，bash等进程</p>
</li>
<li><p>　　检测建立的网络连接</p>
</li>
<li><p>　　检查开放的端口</p>
</li>
</ul>
<p>　例子：通过端口和bash发现可疑进程</p>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170922185224228-1344630297.png" alt="img"></p>
<p>　　如果我们怀疑某个进程正在是受到溢出攻击后创建的shell进程，我们可以分析这个进程是否有socket连接，linux中查看指定进程socket连接数的命令为：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">ls</span> /proc/<span class="token operator">&lt;</span>进程pid<span class="token operator">></span>/fd -l <span class="token operator">|</span> <span class="token function">grep</span> socket: <span class="token operator">|</span> <span class="token function">wc</span> -l
</code></pre>
<p>比如我们查看ssh进程的socket连接。如果我们检测的程序有socket连接，说明它正在进行网络通信，我们就需要进行进一步判断。</p>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170922183157743-1968982131.png" alt="img"></p>
<p>我们还可以检测可疑进程开启的管道。linux下查看进程管道数的命令类似：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">ls</span> /proc/<span class="token operator">&lt;</span>进程pid<span class="token operator">></span>/fd -l <span class="token operator">|</span> <span class="token function">grep</span> pipe: <span class="token operator">|</span> <span class="token function">wc</span> -l
</code></pre>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170922182533290-1861869030.png" alt="img"></p>
<p> 典型的一个例子是：Apache模块后门mod_rootme，它复用了webserver的80端口，mod_rootme通过管道和bash交互数据，但是由于开启了额外的管道，我们从这个变化上便能察觉到。</p>
<p>详细内容可以参考：<a href="http://t.qq.com/p/t/330573116082464" target="_blank" rel="noopener">http://t.qq.com/p/t/330573116082464</a>。</p>
<p>　　总体来说，我们主要可以关注进程情况和网络连接情况，综合分析进程，阻断溢出攻击创建的shel的。</p>
<h2 id="6-漏洞修复简单粗暴"><a href="#6-漏洞修复简单粗暴" class="headerlink" title="6. 漏洞修复简单粗暴"></a>6. 漏洞修复简单粗暴</h2><p>　　CTF比赛中修复漏洞主要就是为了防止其他队伍的入侵了。</p>
<p>　　1. 删站：如果赛组没有明确禁止，这是最粗暴的姿势，只留自己的webshell，参加过几场比赛确实遇到了这种尴尬的事情，web攻防最后都演变成了拼手速的<code>GetShell+留后门+删站</code>。<br>　　2. 删漏洞页面：大部分举办方还是会明确禁止删除网站的，通常赛组会定期访问网站主页（一般来说），从而确定网站是否正常运行。其实我们没必要删除整个网站，只要删掉有漏洞的页面就行了，比如删后台登录页面、注册页面、上传页面等等。<br>　　3. 破坏正常功能：如果明确不能删除任何页面，可以选择让这些漏洞点的功能函数（或者其依赖的功能函数）失效。比如上传点，如果考虑过滤挺麻烦，又不能删页面，那么我们可以找到这个漏洞网页，改掉或者删掉文件里对应的类似upload等这种功能调用函数。</p>
<p>　　上面这三种其实都算不上修补漏洞了，真实环境下哪能这么干。</p>
<p>　　4. 采用正常修补手段：规则限定很严的情况下，我们还是采用正常手法吧，修改服务配置、安装补丁、下载更新的软件版本、加过滤等等。</p>
<p> <img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170928195750262-1280426197.png" alt="img"></p>
<p>　　谈到那个删站，我忍不住想吐槽几句，我个人是不赞成这种做法的，因为这种操作在比赛中很容易拉仇恨并且产生连锁反应，也不利于个人的进步。有些人认为：我先拿下这台服务器说明我有能力，你没进去就说明你没本事，所以我先进去删了站不让其他人进也无可厚非，有能耐你就先拿下它，那你删了我也没意见。也有人说，真正的对抗里，敌人不会对你仁慈～～没错，挺有道理的，而且强者也应该拥有发言权。但是我们不能只从一个角度考虑问题，换个角度去考虑，CTF竞赛虽然是向着真实的网络环境靠拢，但是它的根本目的是提高竞技者的安全技能和知识水平。对于大部分切磋竞技的玩家来说，参加比赛也都是为了让自己获得提高，大家在同一个平台上进行进行切磋对抗，认识到自己和对手身上的优点与不足，这才是竞技。但是这种行为其实从某种意义上来说已经破坏了比赛的公平性，毕竟如果是因为技术不到位，那当然没什么话说，但是如果网站删了，让别人发挥的地方都没有，这种切磋也没有意义。举个不太恰当的例子，这就像两个人打架，你说你比我强，咱们比比再说，但是你都不让我跟你打，这算什么。再换个角度，其实我一直坚信真正具有强者姿态的人，不畏惧挑战、不怕被人超越，不屑于通过这种手段巩固自己的地位。相反，我们只有将自己至于狂风大浪中，才能成长和蜕变，最终成为一个强者。</p>
<p>　　无论从什么角度考虑，我们应该敢于挑战自身、挑战别人，不断强大自己，不断去征服，无畏无惧、步履铿锵！</p>
<h2 id="7-安全软件锦上添花"><a href="#7-安全软件锦上添花" class="headerlink" title="7. 安全软件锦上添花"></a>7. 安全软件锦上添花</h2><p>　　可以使用第三方软件的话，装个WAF，安全狗之类的吧。这个我没什么话要说，附个linux安全狗的链接吧：<br>安全狗linux版：<a href="http://www.safedog.cn/website_safedog.html" target="_blank" rel="noopener">http://www.safedog.cn/website_safedog.html</a></p>
<p>　　我们平时也可以搜集或者自己实现一些脚本或者工具备用。</p>
<p>　　这里有waf一枚：<a href="http://hackblog.cn/post/75.html" target="_blank" rel="noopener">http://hackblog.cn/post/75.html</a></p>
<p>　　如果我们想给web目录文件添加自定义waf脚本，其实可以用一条命令解决,以php为例：</p>
<pre><code>find /var/www/html -type f -path &quot;*.php&quot; | xargs sed -i &quot;s/&lt;?php/&lt;?php\nrequire_once(&#39;\/tmp\/waf.php&#39;);\n/g&quot;
</code></pre><p>命令的意思就是查找/var/www/html目录下所有php文件，在头部添加一句，用require函数引入/tmp/waf.php文件。因为sed命令利用 / 区分文件中的原字符串和修改的字符串，所以我们要对 / 进行转义。类似于在单引号中再次使用单引号时我们也要用反斜杠转义：\’，命令转换过来就是这样：</p>
<pre><code>find /var/www/html -type f -path &quot;*.php&quot; | xargs sed -i &quot;s/&lt;?php/&lt;?php\nrequire_once(&#39;/tmp/waf.php&#39;);\n/g&quot;
</code></pre><p>这样，再次打开时我们就会发现已经引入了自定义waf文件。</p>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170928181501247-383805793.png" alt="img"></p>
<p>如果想整站防护，比如防注入waf，在网站的一个公用文件中，如数据库链接文件<code>config.inc.php</code>中, 引入调用waf代码:</p>
<pre><code>require_once(&#39;waf.php&#39;);
</code></pre><h2 id="8-我可能get了假的flag"><a href="#8-我可能get了假的flag" class="headerlink" title="8. 我可能get了假的flag"></a>8. 我可能get了假的flag</h2><p>　　如果说很不幸，我们前面的关卡都被突破了（实际上我都感觉前面那些设置都有点<code>搅屎</code>的味道了，不过还是希望师傅们能一起来讨论讨论有没有什么骚姿势，以及绕过它们的方法）。假设真的被突破了，对于CTF线下赛来说，我们最终的目的都是拿到flag。通常我们会在服务器上执行类似于”getflag”命令，或者”curl”访问某个url获取flag，然后获取到一个字符串，然后在答题平台上提交这段字符串即可获取分数。就拿前之前的ISCC来说，这个也是我赛后想到的。这个getflag是一个elf的程序，在/usr/bin/下，顺手给下载了，有兴趣的同学可以去逆向一波。重点在这，有几次我getflag的时候因为webshell丢了，服务器显示了Error。后来想想，我们是不是可以故意利用这种报错来欺骗不细心的竞争对手呢，当然我不知道是不是已经有师傅们用了这个手法。这是模拟的效果：</p>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170928195333387-1185344619.png" alt="img"></p>
<p> <img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170928195410106-1460692717.png" alt="img"></p>
<p> 　　怎样实现？比如我们可以添加alias别名，或者我们可以把这些命令更改或者替换掉，换成一些伪装命令程序。再换一层想想，接着上面的思路，如果我们替换或者伪装了系统命令，对方getshell之后，进来发现cd，ls等命令都没法用，会怎么样呢？然而这样会不会不太好～～</p>
<p>　　最后推荐一个感觉挺实用功能很强的远程连接管理工具，可以极大方便我们的工作：<a href="https://mobaxterm.mobatek.net/" target="_blank" rel="noopener">MobaXterm</a>。（不是打广告~）</p>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170928201926981-525307116.png" alt="img"></p>
<p>它支持多种连接方式，可以拖拽进行文件管理。支持在打开的会话一键批量执行命令</p>
<p> <img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170928202117887-1526141416.png" alt="img"></p>
<p>还有一个非常方便的ssh端口转发功能，支持本地、远程、动态转发。</p>
<p><img src="http://images2017.cnblogs.com/blog/1012328/201709/1012328-20170928202717403-1093509689.png" alt="img"></p>
<p>　　还有很多其他功能貌似很厉害，不过我没用过，就不说了…</p>
<p>　　真不是打广告。</p>
<h1 id="三-对CTF举办的一点小小建议"><a href="#三-对CTF举办的一点小小建议" class="headerlink" title="三. 对CTF举办的一点小小建议"></a>三. 对CTF举办的一点小小建议</h1><p>　　如今CTF越来越火，对于这些比赛的举办方，我有着一些不成熟想法和小建议，如果您觉得有什么不合适的地方，纯当娱乐：</p>
<p>　　（1）扩展竞技形式：目前线下赛web攻防占绝大多数，有些小比赛甚至只有若干web服务器，上面放几个不同类型的站点，形式有些单一了，其实可以增加多种对抗模式，甚至可以让参赛选手走出比赛场地。去年曾有幸聆听了诸葛建伟博士关于打破XCTF现有格局的讲座，他提出了体系化攻防演练，认为CTF可以引入实地wifi渗透、门禁系统突破、无人机攻防、GPS信号对抗等，增加比赛多样性与趣味性，让线下赛不再只是局限于小小的机房~~</p>
<p>　　（2）重视安全分析与防护。安全不仅仅只是网络攻防对抗，数据分析、取证分析、应急响应、追踪溯源等技能也相当重要，并且在安全人才圈里这方面缺口也比较大。今年六月份，启明星辰主办的2017”信息安全铁人三项赛”（分为”个人逆向赛“、”数据分析赛“、”企业攻防赛“三个赛事），其中”数据分析赛“便是一个典型代表，参赛选手需要分析真实企业网络环境下受网络攻击的流量数据，从中找出攻击者、分析其网络攻击行为，如欺骗劫持、爆破、webshell连接操作等，找到并分析攻击者的后门或者恶意软件。这种模式，有助于参赛者接触到相对更加真实的网络攻击流量的对抗与防御。</p>
<p>　　（3）完善竞技模式的具体细节，尽量避免取巧或者粗暴姿势。比如拿修补漏洞举例子，现在CTF线下赛中绝大部分参赛者为了维持加固自己的shell，往往都会采用删除部分页面的方法，比如登陆、注册页面，因为采用正常打补丁、修改配置等操作都比较费时费事。但在比赛中这种方式是对于学习真正的安全加固、漏洞修补知识没有太多提高。玩CTF不应该仅仅为了比赛而比赛，或者只是为了拿个奖、拿几张证书，还是要注重从中学到点东西，不过有证书对以后就业还是有些帮助的。</p>
<p> 　　虽然说这些会增加举办方的负担，给选手增加难度，但是这也是一种趋势。CTF必然要经历从普及到提高的转变，并且随着参赛选手水平的提高，我们确实需要一些更有意思的玩法，这是一个相互促进的关系。当然，对于入门级的CTF选手来说，题目难度过大反而会降低比赛体验，对于不同级别的玩家，可以设置不同级别的赛事。从形式上奖，像引入门禁系统突破、无人机攻防等，对于大部分CTF举办方来说实现起来有些难度，毕竟涉及到不同的环境、设备、人员维护等问题，所以这个不应该强求，但是对网络攻防来说增加如windows 服务器、邮件服务器、路由设备等还是可行的。以后的CTF规格和水平会越来越高，对于参赛选手的挑战难度也会越来越大，这对于举办方和选手来说都是挑战，但是挑战亦是机遇，我们应时刻准备好投入战斗！</p>
<h1 id="四-最后的话"><a href="#四-最后的话" class="headerlink" title="四. 最后的话"></a>四. 最后的话</h1><p>　　虽说上面提到的这些姿势不可能让我们的靶机变得无懈可击，但是至少能在某种程度上提高它的防御值，希望能对大家有所帮助。最后，祝愿各位CTF参赛选手在比赛中勇创佳绩，同时也祝愿各单位的大佬们都能把CTF筹办的越来越好！</p>

            </div>
            <hr>

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff;
        background-color: #22AB38;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff;
        background-color: #019FE8;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a class="reward-link btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">您的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs">
                        <li class="tab wechat-tab waves-effect waves-light"><a class="active" href="#wechat">微信</a></li>
                        <li class="tab alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                    </ul>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('#reward .reward-link').on('click', function () {
            $('#rewardModal').openModal();
        });

        $('#rewardModal .close').on('click', function () {
            $('#rewardModal').closeModal();
        });
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            <div class="reprint">
                <p>
                    <span class="reprint-tip">转载请注明: </span>
                    <a href="https://ssooking.github.io" class="b-link-green">ssooking's blog</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/ctf-xian-xia-fang-yu-zhan/" class="b-link-green">CTF线下防御战—让你的靶机变成&#34;铜墙铁壁&#34;</a>
                </p>
            </div>
        </div>
    </div>

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">上一篇</div>
            <div class="card">
                <a href="/kali-shi-yong-anonsurf-pei-he-tor-ni-ming-shang-wang/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="kali使用anonsurf配合tor匿名上网">
                        
                        <span class="card-title">kali使用anonsurf配合tor匿名上网</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">整个系统应用TOR匿名，Anonsurf在后台运行并不断更改IP地址。

注意，国内环境下前提是你的kali能够翻&amp;墙

安装配置torapt-get install tor

去bridges.torproject.org获取br</div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2017-10-14
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/科学上网/" class="post-category" target="_blank">
                                    科学上网
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/kali/" target="_blank">
                        <span class="chip bg-color">kali</span>
                    </a>
                    
                    <a href="/tags/linux/" target="_blank">
                        <span class="chip bg-color">linux</span>
                    </a>
                    
                    <a href="/tags/tor/" target="_blank">
                        <span class="chip bg-color">tor</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">下一篇</div>
            <div class="card">
                <a href="/matlab-ji-chu-han-shu-ming-ling/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/13.jpg" class="responsive-img" alt="MATLAB基础函数命令">
                        
                        <span class="card-title">MATLAB基础函数命令</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary">一. 常用命令dir：列出当前目录下的所有文件clc：清除命令窗clear all：清除环境（从内存中清除所有变量）who：将内存中的当前变量以简单形式列出close all: 关闭所有的 Figure 窗口
二.变量设置1.变量命名
MA</div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2017-09-05
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/程序代码/" class="post-category" target="_blank">
                                    程序代码
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/python/" target="_blank">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                    <a href="/tags/MATLAB/" target="_blank">
                        <span class="chip bg-color">MATLAB</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>
    </div>
    <div class="col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title">目录</div>
            <div id="toc-content">

            </div>
        </div>
    </div>
</div>

<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingSelector: 'h1, h2, h3'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script>
    

</main>

<footer class="page-footer bg-color">
    <div class="container row center-align">
       <div class="col s12 m8 l8 copy-right">
            copyright &copy; <a href="https://ssooking.github.io/" target="_blank">ssooking</a>. 关注安全动态，分享优质文章！
        </div>

        <div class="col s12 m4 l4 social-link"><a href="https://github.com/ssooking" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
    <i class="fa fa-github"></i>
</a>
<a href="mailto:ssooking@yeah.net" class="tooltipped" target="_blank" data-tooltip="mail：ssooking@yeah.net" data-position="top" data-delay="50">
    <i class="fa fa-envelope-open"></i>
</a>

<a href="#!" class="tooltipped" data-tooltip="wechat: licg18238296977" data-position="top" data-delay="50">
    <i class="fa fa-wechat"></i>
</a>

<a href="#!" class="tooltipped" data-tooltip="QQ: 1652010949" data-position="top" data-delay="50">
    <i class="fa fa-qq"></i>
</a>

<a href="https://join.skype.com/invite/PWgoTe4YvrbH" class="tooltipped" target="_blank" data-tooltip="skype：ssooking" data-position="top" data-delay="50">
    <i class="fa fa-skype"></i>
</a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title">搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input" autofocus>
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/js/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>
</body>
</html>